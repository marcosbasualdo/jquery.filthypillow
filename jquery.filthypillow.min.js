!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){var e="plugin_filthypillow",i={startStep:"day",minDateTime:null,maxDateTime:null,initialDateTime:null,enableCalendar:!0,steps:["month","day","year","hour","minute","meridiem"],exitOnBackgroundClick:!0,enable24HourTime:!1,minuteStepSize:15,calendar:{isPinned:!1,saveOnDateSelect:!1},stepsOrder:["month","day","year"],dateFormat:{month:"MM",day:"DD",year:"YYYY"}},n=["show","hide","destroy","updateDateTime","updateDateTimeUnit","setTimeZone"],s=["getDate","isValid"];function a(e,n){var s=t.extend({},i.calendar,n.calendar||{});n.enable24HourTime&&!n.steps&&(n.steps=i.steps.slice(0,-1)),this.options=t.extend({},i,n),this.options.calendar=s,this.$element=e,this.setup()}function o(e,i){this.options=t.extend({},i),this.date=moment(),this.$element=e,this.currentTimeZone=null;this.$container=t('<div class="fp-cal-container"><div class="fp-cal-nav"><span class="fp-cal-left">&#9668;</span><span class="fp-cal-month"></span><span class="fp-cal-right">&#9658;</span></div><table><thead><tr class="fp-cal-days"></tr></thead><tbody class="fp-cal-dates"></tbody></div></div>'),this.$left=this.$container.find(".fp-cal-left"),this.$right=this.$container.find(".fp-cal-right"),this.$month=this.$container.find(".fp-cal-month"),this.$days=this.$container.find(".fp-cal-days"),this.$dates=this.$container.find(".fp-cal-dates"),this.$dateTemplate=t('<td class="fp-cal-date" data-date=""></td>'),this.$weekTemplate=t('<tr class="fp-cal-week"></tr>'),this.$dayLabelTemplate=t('<th class="fp-cal-day-label"></th>'),this.buildDayLabels()}a.prototype={template:'<div class="fp-container"><div><div class="fp-calendar"></div><div class="fp-clock"><span class="fp-hour fp-option"></span>:<span class="fp-minute fp-option"></span><span class="fp-meridiem fp-option"></span></div></div><div class="clearfix"><div class="fp-now"><button class="btn btn-block btn-default fp-now-button" type="button">Now</button></div><div class="fp-save"><button class="btn btn-block btn-primary fp-save-button" type="button">Save</button></div></div><div class="fp-description"></div><div class="fp-errors"></div><div class="fp-calendar-calendar"></div><div class="fp-current"></div><div class="fp-arrows"><span class="fp-arrow-up">&#9652;</span><span class="fp-arrow-down">&#9662;</span></div></div>',currentStep:null,dateTime:null,currentTimeZone:null,currentDigit:0,isActiveLeadingZero:0,stepRegExp:null,isError:!1,isActive:!1,setup:function(){this.steps=this.options.steps,this.stepRegExp=new RegExp(this.steps.join("|")),this.$window=t(window),this.$document=t(document),this.$body=t("body"),this.id="filthypillow-"+Math.round(1e3*Math.random()),this.$container=t(this.template),this.$container.attr("id",this.id),this.$calendar=this.$container.find(".fp-calendar"),this.$options=this.$container.find(".fp-option");var e={day:'<span class="fp-day fp-option"></span>',month:'<span class="fp-month fp-option"></span>',year:'<span class="fp-year fp-option"></span>'};this.$calendar.html(e[this.options.stepsOrder[0]]+"/"+e[this.options.stepsOrder[1]]+"/"+e[this.options.stepsOrder[2]]),this.$month=this.$calendar.find(".fp-month"),this.$day=this.$calendar.find(".fp-day"),this.$year=this.$calendar.find(".fp-year"),this.$clock=this.$container.find(".fp-clock"),this.$hour=this.$clock.find(".fp-hour"),this.$minute=this.$clock.find(".fp-minute"),this.$meridiem=this.$clock.find(".fp-meridiem"),this.$errorBox=this.$container.find(".fp-errors"),this.$saveButton=this.$container.find(".fp-save-button"),this.$nowButton=this.$container.find(".fp-now-button"),this.$descriptionBox=this.$container.find(".fp-description"),this.$currentContainer=this.$container.find(".fp-current"),this.$arrowsContainer=this.$container.find(".fp-arrows"),this.$arrowUp=this.$container.find(".fp-arrow-up"),this.$arrowDown=this.$container.find(".fp-arrow-down"),this.options.enable24HourTime&&this.$meridiem.hide(),this.options.enableCalendar&&(this.calendar=new o(this.$container.find(".fp-calendar-calendar"),{minDateTime:this.options.minDateTime,maxDateTime:this.options.maxDateTime,onSelectDate:t.proxy(function(t,e,i,n){this.updateDateTimeUnit("month",e,!1),this.updateDateTimeUnit("date",i,!1),this.updateDateTimeUnit("year",t,!1),this.options.calendar.saveOnDateSelect&&n.activeDateClicked&&this.$saveButton.click()},this)})),this.setInitialDateTime()},showError:function(t,e){t&&this["$"+t]&&this["$"+t].addClass("fp-error fp-out-of-range"),this.$errorBox.text(e).show(),this.$saveButton.attr("disabled","disabled"),this.isError=!0},hideError:function(t,e){this.$container.find(".fp-error").removeClass("fp-error"),this.$errorBox.hide(),this.$saveButton.removeAttr("disabled","disabled"),this.isError=!1},activateSelectorTool:function(t){var e=this["$"+t];this.currentStep=t,this.$container.find(".active").unwrap(this.$currentContainer),this.$container.find(".active").removeClass("active"),e.addClass("active"),this.currentDigit=0,this.isActiveLeadingZero=0,this.options.enableCalendar&&("day"===t||"month"===t||"year"===t?this.calendar.show():this.options.calendar.isPinned||this.calendar.hide()),e.wrap(this.$currentContainer),e.after(this.$arrowsContainer)},to12Hour:function(t){return"PM"===this.dateTime.format("A")&&t>12?t-12:t},to24Hour:function(t){return"PM"===this.dateTime.format("A")&&t<12?t+12:"AM"===this.dateTime.format("A")&&t>11?t-12:t},formatToMoment:function(t,e){return"month"===t?e-1:e},formatFromMoment:function(t,e){return"month"===t?e+1:e},isValidDigitInput:function(t){if(t=parseInt(t,10),"month"===this.currentStep){if(t>12)return!1}else if("day"===this.currentStep&&t>this.dateTime.daysInMonth())return!1;return!0},updateDigit:function(t,e,i){var n,s,a=!1;"meridiem"!==t&&("day"===t&&(t="date"),1!==e||0!==i?(e>1&&!this.isActiveLeadingZero?(s=this.dateTime.get(t),s="hour"===t?this.to12Hour(s):this.formatFromMoment(t,s),n=parseInt(s+""+i,10)):this.isActiveLeadingZero=0,n=n||i,"hour"===t?this.options.enable24HourTime||(n=this.to24Hour(n)):n=this.formatToMoment(t,n),this.isValidDigitInput(n)?(this.currentDigit===("year"==this.currentStep?4:2)?a=!0:"month"===t&&i>1?a=!0:"date"===t&&i>3?a=!0:"hour"===t&&(i>1&&!this.options.enable24HourTime||i>2)?a=!0:"minute"===t&&i>5&&(a=!0),this.updateDateTimeUnit(t,n,a)):this.currentDigit===("year"==this.currentStep?4:2)&&(this.currentDigit=1)):this.isActiveLeadingZero=1)},onOptionClick:function(e){var i=t(e.target).attr("class").match(this.stepRegExp);i&&i.length&&this.activateSelectorTool(i[0])},onKeyUp:function(t){var e=t.keyCode||t.which;"meridiem"!==this.currentStep&&(8===e&&(this.currentDigit-=1),(e>=48&&e<=57||e>=96&&e<=105)&&(this.currentDigit+=1,this.updateDigit(this.currentStep,this.currentDigit,e%48)),this.currentDigit===("year"==this.currentStep?4:2)&&(this.currentDigit=0))},onKeyDown:function(t){var e=t.keyCode||t.which;switch(e){case 38:this.moveUp();break;case 40:this.moveDown();break;case 37:this.moveLeft();break;case 39:this.moveRight();break;case 65:"meridiem"===this.currentStep&&this.changeMeridiem("a");break;case 80:"meridiem"===this.currentStep&&this.changeMeridiem("p")}return t.shiftKey&&9===e?this.moveLeft():9===e&&this.moveRight(),13===e&&this.$saveButton.click(),!1},moveDown:function(){"meridiem"===this.currentStep?this.changeMeridiem():"minute"===this.currentStep?this.changeDateTimeUnit(this.currentStep,-1*parseInt(this.options.minuteStepSize)):this.currentStep&&this.changeDateTimeUnit(this.currentStep,-1),this.currentDigit=0},moveUp:function(){"meridiem"===this.currentStep?this.changeMeridiem():"minute"===this.currentStep?this.changeDateTimeUnit(this.currentStep,parseInt(this.options.minuteStepSize)):this.currentStep&&this.changeDateTimeUnit(this.currentStep,1),this.currentDigit=0},changeMeridiem:function(t){var e=parseInt(this.dateTime.format("H"),10)<12?12:-12;if(t)switch(t.toLowerCase()){case"a":e=e<0?e:0;break;case"p":e=e>0?e:0}this.changeDateTimeUnit("hour",e)},moveLeft:function(){if(this.currentStep){var t=this.steps.indexOf(this.currentStep);0===t?t=this.steps.length-1:t-=1,this.activateSelectorTool(this.steps[t])}},moveRight:function(){if(this.currentStep){var t=this.steps.indexOf(this.currentStep);t===this.steps.length-1?t=0:t+=1,this.activateSelectorTool(this.steps[t])}},onClickToExit:function(e){var i=t(e.target);/fp-/.test(i.attr("class"))||i.closest(this.$container).length||i.closest(this.$element).length||this.hide()},onSave:function(){this.isInRange(this.dateTime)&&this.$element.trigger("fp:save",[this.dateTime])},onNow:function(){this.setDateTime(new Date),this.renderDateTime(),this.dateChange()},addEvents:function(){this.$options.on("click",t.proxy(this.onOptionClick,this)),this.$saveButton.on("click",t.proxy(this.onSave,this)),this.$nowButton.on("click",t.proxy(this.onNow,this)),this.$document.on("keydown."+this.id,t.proxy(this.onKeyDown,this)),this.$document.on("keyup."+this.id,t.proxy(this.onKeyUp,this)),this.$arrowDown.on("click",t.proxy(this.moveDown,this)),this.$arrowUp.on("click",t.proxy(this.moveUp,this)),this.$document.on("scroll",t.proxy(this.hide,this)),this.options.exitOnBackgroundClick&&this.$window.on("click",t.proxy(this.onClickToExit,this))},removeEvents:function(){this.$options.off("click"),this.$saveButton.off("click"),this.$window.off("click."+this.id),this.$document.off("keydown."+this.id),this.$document.off("keyup."+this.id),this.$document.off("scroll")},setDateTime:function(t,e){this.dateTime=moment(t),this.options.enableCalendar&&this.calendar.setDate(this.dateTime),this.isInRange(this.dateTime)?this.isError&&this.hideError():this.showError(this.currentStep,"Date is out of range, please fix."),!this.isError&&e&&this.moveRight()},renderDateTime:function(){this.$year.text(this.dateTime.format(this.options.dateFormat.year)),this.$month.text(this.dateTime.format(this.options.dateFormat.month)),this.$day.text(this.dateTime.format(this.options.dateFormat.day)),this.$hour.text(this.dateTime.format(this.options.enable24HourTime?"HH":"hh")),this.$minute.text(this.dateTime.format("mm")),this.options.enable24HourTime||this.$meridiem.text(this.dateTime.format("A")),this.$descriptionBox.text(this.dateTime.format("LLLL"))},setInitialDateTime:function(){var t=moment();t.format("m");t.zone(this.currentTimeZone),"function"==typeof this.options.initialDateTime&&(t=this.options.initialDateTime(t.clone())),this.updateDateTime(t)},isInRange:function(t){var e="function"==typeof this.options.minDateTime&&this.options.minDateTime(),i="function"==typeof this.options.maxDateTime&&this.options.maxDateTime(),n=right=!1;return e&&(e.zone(this.currentTimeZone),n=t.diff(e,"second")<0),i&&(i.zone(this.currentTimeZone),right=t.diff(i,"second")>0),!(right||n)},setTimeZone:function(t){this.dateTime.zone(t),this.currentTimeZone=t,this.options.enableCalendar&&this.calendar.setTimeZone(t)},dateChange:function(){this.options.enableCalendar&&(this.calendar.setDate(this.dateTime),"day"!==this.currentStep&&"month"!==this.currentStep&&"year"!==this.currentStep||this.calendar.render()),this.$element.trigger("fp:datetimechange",[this.dateTime])},changeDateTimeUnit:function(t,e){var i=this.dateTime.clone().add(e,t+"s"),n=this.isInRange(i);this.isError||n?n&&this.hideError():this.showError(this.currentStep,"Date is out of range, please fix."),this.dateTime.add(e,t+"s"),this.renderDateTime(),this.dateChange()},updateDateTimeUnit:function(t,e,i){var n=this.dateTime.clone().set(t,e);this.updateDateTime(n,i)},getDate:function(){return this.dateTime.clone()},isValid:function(){return!this.isError},updateDateTime:function(t,e){this.setDateTime(t,e),this.renderDateTime(),this.dateChange()},checkPositionInterval:null,clearCheckPositionInterval:function(){null!=this.checkPositionInterval&&clearInterval(this.checkPositionInterval),this.checkPositionInterval=null},currentPosition:{top:null,left:null},positionElement:function(){var t=this.currentPosition.top;this.$window.scrollTop()+this.$window.height()<this.currentPosition.top+this.$container.height()&&(t=this.currentPosition.top-this.$container.height()-this.$element.height());var e=this.currentPosition.left;this.$window.scrollLeft()+this.$window.width()<this.currentPosition.left+this.$container.width()&&(e=this.$window.width()-this.$container.width()),this.$container.css({left:e+"px",top:t+"px"})},getElementPosition:function(){var t=this.$element.offset();return{top:t.top+this.$element.height(),left:t.left}},show:function(){this.isActive||(this.setInitialDateTime(),this.clearCheckPositionInterval(),t("body").prepend(this.$container),this.$container.hide(),this.checkPositionInterval=setInterval(function(){if(!t(this.$element).is(":visible"))return this.hide();var e=this.getElementPosition();this.$container.show(),this.currentPosition=e,this.positionElement()}.bind(this),250),this.activateSelectorTool(this.options.startStep),this.addEvents(),this.isActive=!0)},hide:function(){this.clearCheckPositionInterval(),this.currentPosition.left=this.currentPosition.top=null,this.isActive&&(this.$container.remove(),this.removeEvents(),this.isActive=!1,this.$element.trigger("fp:hide",[this.dateTime]))},destroy:function(){this.clearCheckPositionInterval(),this.currentPosition.left=this.currentPosition.top=null,this.removeEvents(),this.$container.remove(),this.isActive=!1,this.$element.removeData(e)}},o.prototype.setDate=function(t){this.date=t.clone()},o.prototype.removeEvents=function(){this.$right.off("click"),this.$left.off("click"),this.$dates.find(".fp-cal-date:not( .fp-disabled )").off("click")},o.prototype.addEvents=function(){this.$right.on("click",t.proxy(this.nextMonth,this)),this.$left.on("click",t.proxy(this.prevMonth,this)),this.$dates.find(".fp-cal-date:not( .fp-disabled )").on("click",t.proxy(this.onSelectDate,this))},o.prototype.toggleMonthArrows=function(){this.isInMinRange(this.date.clone().subtract(1,"month").endOf("month"))?this.$left.show():this.$left.hide(),this.isInMaxRange(this.date.clone().add(1,"month").date(1))?this.$right.show():this.$right.hide()},o.prototype.nextMonth=function(){this.date.add(1,"month"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},o.prototype.prevMonth=function(){this.date.subtract(1,"month"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},o.prototype.nextYear=function(){this.date.add(1,"year"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},o.prototype.prevYear=function(){this.date.subtract(1,"year"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},o.prototype.selectDate=function(t,e,i,n){"function"==typeof this.options.onSelectDate&&this.options.onSelectDate(t,e,i,n||{}),this.highlightDate(i)},o.prototype.onSelectDate=function(e){var i=t(e.target),n=parseInt(i.attr("data-add-month"),10);this.date.add(n,"month"),this.selectDate(this.date.get("year"),this.date.get("month"),i.attr("data-date"),{activeDateClicked:!n})},o.prototype.highlightDate=function(t){this.$dates.find(".active").removeClass("active"),this.$dates.find(".fp-cal-date-"+t).addClass("active")},o.prototype.buildTemplate=function(){this.$month.text(this.date.format("MMMM YYYY")).attr("data-month",this.date.get("month")+1),this.toggleMonthArrows(),this.buildDates(),this.disableOutOfRangeDates(),this.highlightDate(this.date.get("date"))},o.prototype.isInMinRange=function(t){if("function"!=typeof this.options.minDateTime)return!0;var e=this.options.minDateTime();return e.zone(this.currentTimeZone),t.diff(e,"second")>0},o.prototype.isInMaxRange=function(t){if("function"!=typeof this.options.maxDateTime)return!0;var e=this.options.maxDateTime();return e.zone(this.currentTimeZone),t.diff(e,"second")<0},o.prototype.disableOutOfRangeDates=function(){var e,i,n=this;"function"!=typeof n.options.maxDateTime&&"function"!=typeof n.options.minDateTime||this.$dates.find(".fp-cal-date").filter(function(){return e=n.date.clone(),(i=t(this)).attr("data-add-month")&&e.add(parseInt(i.attr("data-add-month"),10),"month"),e.date(parseInt(t(this).attr("data-date"),10)),!(n.isInMinRange(e)&&n.isInMaxRange(e))}).addClass("fp-disabled")},o.prototype.buildDayLabels=function(){for(var t=this.date.clone(),e=0;e<7;++e)this.$dayLabelTemplate.clone().text(t.day(e).format("ddd")).appendTo(this.$days)},o.prototype.buildDates=function(){var t,e=this.date.daysInMonth(),i=this.date.clone(),n=this.date.clone().subtract(1,"month").endOf("month").date(),s=this.$weekTemplate.clone(),a=i.date(1).weekday(),o=i.date(e).weekday();for(this.$dates.empty(),t=0;t<a;++t)this.$dateTemplate.clone().attr("data-add-month",-1).attr("data-date",n-t).addClass("fp-cal-date-prev-"+n-t).addClass("fp-not-in-month").text(n-t).prependTo(s);for(t=1;t<=7-a;++t)this.$dateTemplate.clone().addClass("fp-cal-date-"+t).attr("data-date",t).text(t).appendTo(s);for(s.appendTo(this.$dates),(s=this.$weekTemplate.clone()).appendTo(this.$dates);t<=e;++t)(t+a-1)%7==0&&(s=this.$weekTemplate.clone()).appendTo(this.$dates),this.$dateTemplate.clone().addClass("fp-cal-date-"+t).attr("data-date",t).text(t).appendTo(s);for(t=1;t<7-o;++t)this.$dateTemplate.clone().addClass("fp-cal-date-next-"+t).attr("data-add-month",1).attr("data-date",t).addClass("fp-not-in-month").text(t).appendTo(s)},o.prototype.render=function(){this.buildTemplate(),this.removeEvents(),this.addEvents()},o.prototype.show=function(){this.render(),this.$container.appendTo(this.$element)},o.prototype.hide=function(){this.$container.remove(),this.removeEvents()},o.prototype.get=function(){return this.$container},o.prototype.setTimeZone=function(t){this.currentTimeZone=t},t.fn.filthypillow=function(i){var o,r=Array.prototype.slice.call(arguments);return"string"===(typeof(i=i||{})).toLowerCase()&&~t.inArray(i,s)?this.data(e)[i].apply(this.data(e),r.slice(1,r.length)):this.each(function(){if((o=t(this)).data(e)||"object"!==(typeof i).toLowerCase()){if("string"===(typeof i).toLowerCase()){if(!~t.inArray(i,n))throw new Error("Method "+i+" does not exist. Did you instantiate filthypillow?");o.data(e)[i].apply(o.data(e),r.slice(1,r.length))}}else o.data(e,new a(o,i))})}});